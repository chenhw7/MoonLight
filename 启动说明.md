# MoonLight 开发环境启动说明

## 问题诊断

你遇到的 "无法连接到服务器" 是因为：

1. **前端环境变量未生效**：`.env.local` 是脚本启动后才创建/更新的，但前端已经在运行，没有重新读取环境变量
2. **前端请求路径**：前端现在应该向 `/api/v1` 发请求（相对路径），由 Vite 代理转发到 WSL 后端

## 正确启动流程

### 步骤 1：停止所有服务

在当前运行前端的终端按 `Ctrl+C` 停止前端。

后端会自动在后台继续运行（不用管）。

### 步骤 2：重新运行启动脚本

```bash
cd /mnt/d/cv_study/MoonLight
./start-dev.sh
```

**重要**：脚本会：
- 自动获取最新的 WSL IP
- 更新 `.env.local`
- 启动后端（如果未运行）
- **重新启动前端**（让环境变量生效）

### 步骤 3：访问前端

浏览器打开脚本输出的地址（可能是 3000 或 3001 端口）

## 验证是否正常

打开浏览器开发者工具 → Network 标签：

### ✅ 正确的请求
```
请求 URL: http://localhost:3001/api/v1/resumes/xxx
```

前端向自己的 Vite 服务器（localhost:3001）发请求，Vite 代理自动转发到 WSL 后端。

### ❌ 错误的请求
```
请求 URL: http://172.30.90.50:8000/api/v1/resumes/xxx
```

如果看到这个，说明前端没有使用代理，环境变量未生效，需要重启前端。

## 查看后端日志

如果需要查看后端详细日志：

```bash
tail -f /mnt/d/cv_study/MoonLight/backend.log
```

或在 Windows PowerShell：
```powershell
wsl tail -f /mnt/d/cv_study/MoonLight/backend.log
```

## 停止所有服务

### 停止前端
在运行前端的终端按 `Ctrl+C`

### 停止后端
```bash
wsl pkill -f "uvicorn app.main:app"
```

或者：
```bash
wsl kill $(wsl pgrep -f "uvicorn")
```

## 常见问题

### Q: 端口 3000 被占用
A: 脚本会自动使用 3001 或其他可用端口，注意看脚本输出的实际端口

### Q: WSL IP 变了
A: 重新运行 `./start-dev.sh` 即可，脚本会自动获取新 IP

### Q: 数据库连接失败
A: 确保 Docker 容器在运行：
```bash
cd /mnt/d/cv_study/MoonLight
docker-compose ps
```

如果没运行：
```bash
docker-compose up -d postgres redis
```
