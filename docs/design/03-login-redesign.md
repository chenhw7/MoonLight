# 登录页面重构设计文档

> 文档版本：v1.0  
> 创建日期：2026-02-02  
> 状态：待审批

## 一、需求背景

### 1.1 当前问题

当前登录系统存在以下问题，影响用户体验和操作效率：

| 问题类型 | 具体描述 | 影响程度 |
|----------|----------|----------|
| 登录体验不佳 | 邮箱输入后直接跳转到密码页，无明确标题引导，用户缺乏方向感 | 高 |
| 错误提示不明确 | 所有错误统一显示"邮箱或密码错误"，无法区分是账号问题还是密码问题 | 高 |
| 流程设计复杂 | 登录、注册、验证码混合在同一页面，用户理解成本高，操作路径不清晰 | 中 |
| 找回密码缺失 | 只有"忘记密码"链接，无实际找回密码功能，用户无法重置密码 | 高 |
| 功能不完整 | 未实现"记住我"功能，用户每次访问都需要重新登录 | 中 |

### 1.2 用户反馈总结

根据用户反馈，登录页面需要满足以下核心需求：

- **界面标题**：主标题显示"MoonLight"，简洁明了
- **错误区分**：账号未注册显示黄色提示，密码错误显示红色提示
- **页面独立**：登录、注册、找回密码各为独立页面，流程清晰
- **找回密码**：实现完整的找回密码流程，支持邮箱验证
- **记住我**：保持与当前实现一致的记住我功能

## 二、设计目标

### 2.1 核心设计原则

本设计方案遵循以下核心原则，确保登录系统的用户体验达到大厂级别水准：

- **简洁清晰**：页面元素精简，主次分明，减少用户认知负担
- **大厂风格**：参考主流产品（如阿里云、腾讯云、字节跳动）的登录界面设计规范
- **用户体验**：错误提示友好直观，操作流程顺畅自然，降低用户学习成本
- **安全优先**：验证码、密码强度校验等安全措施完善，保障账户安全
- **渐进增强**：基础功能优先实现，高级功能逐步迭代完善

### 2.2 页面整体规划

根据功能划分和用户操作路径，将登录系统拆分为三个独立页面：

| 页面名称 | 访问路径 | 核心功能 | 用户价值 |
|----------|----------|----------|----------|
| 登录页 | `/login` | 邮箱密码登录、记住我、找回密码入口、注册入口 | 用户日常登录的主要入口 |
| 注册页 | `/register` | 邮箱注册、密码设置、验证码验证 | 新用户创建账户的入口 |
| 找回密码页 | `/forgot-password` | 邮箱验证、验证码验证、重置密码 | 帮助用户恢复账户访问权限 |

## 三、页面设计详情

### 3.1 登录页设计

#### 3.1.1 页面布局

登录页采用居中卡片式布局，整体视觉效果简洁大气：

```
┌─────────────────────────────────────────────────┐
│                                                 │
│              🌙 MoonLight                       │  ← 主标题，醒目展示
│                                                 │
│   ┌─────────────────────────────────────────┐   │
│   │                                         │   │
│   │  📧 邮箱地址                             │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │ name@example.com                  │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │                                         │   │
│   │  🔒 密码                                │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │ **********              👁        │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │                                         │   │
│   │  ☐ 记住我                               │   │
│   │                                         │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │            登  录                  │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │                                         │   │
│   │  🔗 忘记密码？        📝 注册           │   │
│   │                                         │   │
│   └─────────────────────────────────────────┘   │
│                                                 │
│   © 2026 MoonLight. All rights reserved.        │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.1.2 错误提示设计

为用户提供清晰明确的错误反馈，帮助用户快速定位和解决问题：

| 错误类型 | 触发条件 | 提示文案 | 提示颜色 | 设计说明 |
|----------|----------|----------|----------|----------|
| 邮箱格式错误 | 用户输入格式无效的邮箱地址 | 请输入有效的邮箱地址 | 红色（#dc2626） | 实时校验，失焦或提交时触发 |
| 账号未注册 | 邮箱在系统中不存在 | 该邮箱尚未注册，请先注册账号 | 黄色（#d97706） | 提交登录时触发，提示引导注册 |
| 密码错误 | 邮箱存在但密码不正确 | 密码错误，请重试 | 红色（#dc2626） | 提交登录时触发，保留邮箱输入 |
| 网络错误 | 网络请求失败或超时 | 网络连接异常，请检查网络 | 灰色（#6b7280） | 请求失败时触发，提供重试机会 |

#### 3.1.3 记住我功能

记住我功能与当前实现保持一致，提供两种登录状态：

| 状态 | Token 有效期 | 适用场景 |
|------|--------------|----------|
| 勾选记住我 | accessToken：30天，refreshToken：30天 | 用户在可信设备上使用 |
| 未勾选 | accessToken：7天，refreshToken：30天 | 用户在公共设备上使用 |

### 3.2 注册页设计

#### 3.2.1 页面布局

注册页采用垂直堆叠式表单布局，用户可以一次性完成所有注册信息的填写：

```
┌─────────────────────────────────────────────────┐
│                                                 │
│              🌙 MoonLight                       │
│                                                 │
│              创建账户                           │
│                                                 │
│   ┌─────────────────────────────────────────┐   │
│   │                                         │   │
│   │  📧 邮箱地址                             │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │ name@example.com                  │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │                                         │   │
│   │  🔒 设置密码                            │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │ **********              👁        │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │  💡 密码需8位以上，包含字母和数字        │   │
│   │                                         │   │
│   │  🔒 确认密码                            │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │ **********              👁        │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │                                         │   │
│   │  🔢 验证码                              │   │
│   │  ┌───────────────┐  ┌──────────────┐  │   │
│   │  │ 123456        │  │ 获取验证码   │  │   │
│   │  └───────────────┘  └──────────────┘  │   │
│   │                                         │   │
│   │  ┌───────────────────────────────────┐  │   │
│   │  │            注  册                  │  │   │
│   │  └───────────────────────────────────┘  │   │
│   │                                         │   │
│   │  🔗 已有账号？立即登录                   │   │
│   │                                         │   │
│   └─────────────────────────────────────────┘   │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.2.2 验证码按钮状态机

验证码按钮根据不同状态展示对应样式和交互效果：

| 状态 | 按钮显示 | 是否禁用 | 触发条件 |
|------|----------|----------|----------|
| 初始状态 | 获取验证码 | 否 | 页面加载完成 |
| 发送中 | 发送中... | 是 | 用户点击发送 |
| 倒计时 | 60秒后重试（数字递减） | 是 | 发送成功 |
| 可重发 | 重新发送 | 否 | 倒计时结束 |
| 发送失败 | 获取验证码 | 否 | 发送超时或错误 |

#### 3.2.3 密码强度校验规则

密码强度校验与当前实现保持一致，确保密码安全性：

| 校验规则 | 要求 | 提示信息 |
|----------|------|----------|
| 最小长度 | 8位 | 密码至少需要8位字符 |
| 字母要求 | 包含大小写字母 | 密码需要包含字母 |
| 数字要求 | 包含数字 | 密码需要包含数字 |
| 强度指示 | 弱、中、强三级 | 实时显示密码强度 |

### 3.3 找回密码页设计

#### 3.3.1 页面布局

找回密码页采用步骤引导式设计，将复杂流程分解为三个简单步骤：

```
┌─────────────────────────────────────────────────┐
│                                                 │
│              🌙 MoonLight                       │
│                                                 │
│              找回密码                           │
│        请通过邮箱验证重置您的密码                 │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  ○ 步骤 1/3：输入邮箱                    │   │
│  │  ┌───────────────────────────────────┐  │   │
│  │  │ name@example.com                  │  │   │
│  │  └───────────────────────────────────┘  │   │
│  │      ┌───────────────────────────────┐  │   │
│  │      │       发送验证码               │  │   │
│  │      └───────────────────────────────┘  │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  ○ 步骤 2/3：输入验证码                  │   │
│  │  ┌───────────────────┐                  │   │
│  │  │ [1][2][3][4][5][6]│                  │   │
│  │  └───────────────────┘                  │   │
│  │  没有收到验证码？60秒后重试              │   │
│  │      ┌───────────────────────────────┐  │   │
│  │      │         下一步                 │  │   │
│  │      └───────────────────────────────┘  │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │  ○ 步骤 3/3：设置新密码                  │   │
│  │  ┌───────────────────────────────────┐  │   │
│  │  │ 新密码                            │  │   │
│  │  └───────────────────────────────────┘  │   │
│  │  ┌───────────────────────────────────┐  │   │
│  │  │ 确认密码                          │  │   │
│  │  └───────────────────────────────────┘  │   │
│  │      ┌───────────────────────────────┐  │   │
│  │      │       重置密码                 │  │   │
│  │      └───────────────────────────────┘  │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│      🔗 返回登录                               │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.3.2 步骤切换逻辑

步骤切换遵循严格的流程控制，确保用户按正确顺序完成操作：

| 当前步骤 | 用户操作 | 切换结果 | 状态变化 |
|----------|----------|----------|----------|
| 步骤1 | 输入邮箱并点击发送验证码 | 进入步骤2 | 步骤1标记为完成，步骤2激活 |
| 步骤2 | 输入正确验证码并点击下一步 | 进入步骤3 | 步骤2标记为完成，步骤3激活 |
| 步骤3 | 输入新密码并点击重置密码 | 流程完成 | 显示成功提示，跳转登录页 |
| 任意步骤 | 点击返回登录 | 跳转到登录页 | 放弃找回密码流程 |

#### 3.3.3 验证码有效期

找回密码验证码采用更严格的有效期设置，保障账户安全：

| 参数 | 值 | 说明 |
|------|-----|------|
| 验证码长度 | 6位数字 | 便于用户输入，降低错误率 |
| 有效期 | 30分钟 | 充足的时间让用户查看邮箱 |
| 重发间隔 | 60秒 | 防止恶意刷发验证码 |
| 错误尝试上限 | 5次 | 超过后验证码失效，需重新发送 |

## 四、API接口设计

### 4.1 新增接口清单

为支持找回密码功能，需要在后端新增以下三个API接口：

| 接口名称 | HTTP方法 | 访问路径 | 功能描述 |
|----------|----------|----------|----------|
| 发送重置密码验证码 | POST | `/auth/send-reset-code` | 向用户邮箱发送密码重置验证码 |
| 验证重置密码验证码 | POST | `/auth/verify-reset-code` | 验证用户输入的验证码是否正确 |
| 重置密码 | POST | `/auth/reset-password` | 使用验证码将用户密码重置为新密码 |

### 4.2 接口详细设计

#### 4.2.1 发送重置密码验证码接口

**接口功能**：向指定邮箱发送密码重置验证码，用于找回密码流程的第一步。

**请求参数**：

```json
POST /auth/send-reset-code
Content-Type: application/json

{
  "email": "user@example.com"
}
```

| 参数名 | 类型 | 必填 | 验证规则 | 说明 |
|--------|------|------|----------|------|
| email | string | 是 | 有效的邮箱格式 | 需要接收验证码的邮箱地址 |

**响应数据**：

| 状态码 | 响应体 | 说明 |
|--------|--------|------|
| 200 | `{"code": 200, "message": "验证码已发送", "data": null}` | 发送成功 |
| 400 | `{"code": 400, "message": "邮箱格式错误", "data": null}` | 邮箱格式无效 |
| 404 | `{"code": 404, "message": "邮箱未注册", "data": null}` | 邮箱不在系统中 |

**错误处理**：

- 如果邮箱未注册，返回404错误，提示用户该邮箱尚未注册
- 如果60秒内重复请求，返回429错误，提示请稍后再试
- 如果发送失败，返回500错误，提示服务暂时不可用

#### 4.2.2 验证重置密码验证码接口

**接口功能**：验证用户输入的验证码是否正确且有效，用于找回密码流程的第二步。

**请求参数**：

```json
POST /auth/verify-reset-code
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456",
  "code_type": "reset"
}
```

| 参数名 | 类型 | 必填 | 验证规则 | 说明 |
|--------|------|------|----------|------|
| email | string | 是 | 有效的邮箱格式 | 申请验证码的邮箱地址 |
| code | string | 是 | 6位数字 | 用户输入的验证码 |
| code_type | string | 是 | 固定值："reset" | 验证码类型标识 |

**响应数据**：

| 状态码 | 响应体 | 说明 |
|--------|--------|------|
| 200 | `{"code": 200, "message": "验证码有效", "data": {"valid": true}}` | 验证码正确 |
| 400 | `{"code": 400, "message": "验证码格式错误", "data": null}` | 验证码格式无效 |
| 401 | `{"code": 401, "message": "验证码错误或已过期", "data": {"valid": false}}` | 验证码错误或过期 |

**安全控制**：

- 验证码错误5次后自动失效，需重新发送
- 验证码有效期30分钟，过期后需重新申请
- 验证成功的验证码立即失效，防止重复使用

#### 4.2.3 重置密码接口

**接口功能**：使用已验证的验证码将用户密码重置为新密码，用于找回密码流程的第三步。

**请求参数**：

```json
POST /auth/reset-password
Content-Type: application/json

{
  "email": "user@example.com",
  "code": "123456",
  "newPassword": "NewPassword123"
}
```

| 参数名 | 类型 | 必填 | 验证规则 | 说明 |
|--------|------|------|----------|------|
| email | string | 是 | 有效的邮箱格式 | 需要重置密码的账户邮箱 |
| code | string | 是 | 6位数字 | 通过验证的验证码 |
| newPassword | string | 是 | 8位以上，包含字母和数字 | 新密码 |

**响应数据**：

| 状态码 | 响应体 | 说明 |
|--------|--------|------|
| 200 | `{"code": 200, "message": "密码重置成功", "data": null}` | 重置成功 |
| 400 | `{"code": 400, "message": "密码格式错误", "data": null}` | 新密码不符合要求 |
| 401 | `{"code": 401, "message": "验证码已过期", "data": null}` | 验证码已失效 |

**后续处理**：

- 密码重置成功后，使该账户的所有现有token失效
- 发送密码重置成功的通知邮件给用户
- 记录密码重置日志，便于安全审计

### 4.3 前端API封装

在前端 `src/services/auth.ts` 文件中新增以下API调用方法：

```typescript
// src/services/auth.ts 新增接口

export const authApi = {
  // ... 现有接口保持不变

  /**
   * 发送重置密码验证码
   * @param email - 用户邮箱地址
   */
  sendResetCode: (email: string) =>
    api.post<ApiResponse<void>>('/auth/send-reset-code', { email }),

  /**
   * 验证重置密码验证码
   * @param email - 用户邮箱地址
   * @param code - 验证码
   */
  verifyResetCode: (email: string, code: string) =>
    api.post<ApiResponse<{ valid: boolean }>>('/auth/verify-reset-code', {
      email,
      code,
      code_type: 'reset',
    }),

  /**
   * 重置密码
   * @param email - 用户邮箱地址
   * @param code - 验证码
   * @param newPassword - 新密码
   */
  resetPassword: (email: string, code: string, newPassword: string) =>
    api.post<ApiResponse<void>>('/auth/reset-password', {
      email,
      code,
      newPassword,
    }),
};
```

## 五、组件架构设计

### 5.1 目录结构规划

按照功能模块组织页面组件，确保代码结构清晰、可维护性强：

```
src/pages/
  /Login                    # 登录模块
    index.tsx               # 登录页入口组件
    LoginForm.tsx           # 登录表单组件
    RememberMe.tsx          # 记住我复选框组件
    LoginError.tsx          # 登录错误提示组件

  /Register                 # 注册模块
    index.tsx               # 注册页入口组件
    RegisterForm.tsx        # 注册表单组件
    VerificationCodeInput.tsx  # 验证码输入组件
    PasswordInput.tsx       # 密码输入组件（带显示切换）

  /ForgotPassword           # 找回密码模块
    index.tsx               # 找回密码页入口组件
    ForgotPasswordForm.tsx  # 找回密码表单组件
    StepIndicator.tsx       # 步骤指示器组件
    StepEmail.tsx           # 步骤1：输入邮箱组件
    StepVerifyCode.tsx      # 步骤2：输入验证码组件
    StepNewPassword.tsx     # 步骤3：设置新密码组件
```

### 5.2 组件职责定义

#### 5.2.1 登录模块组件

**LoginPage（登录页入口）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 无 | - | - | 纯展示组件，负责布局和样式 |

**职责**：渲染登录页的整体布局，包含MoonLight标题、登录表单和底部版权信息。

**LoginForm（登录表单）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| onLoginSuccess | (user: User, accessToken: string, refreshToken: string) => void | 是 | 登录成功后的回调函数 |
| onNavigateToRegister | () => void | 是 | 跳转到注册页的回调函数 |
| onNavigateToForgotPassword | () => void | 是 | 跳转到找回密码页的回调函数 |

**职责**：处理用户登录的全部逻辑，包括邮箱验证、密码验证、错误显示和登录成功后的状态更新。

**LoginError（登录错误提示）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| type | 'email' | 'password' | 'network' | 是 | 错误类型 |
| message | string | 是 | 错误提示信息 |

**职责**：根据错误类型显示对应颜色和内容的错误提示。

#### 5.2.2 注册模块组件

**RegisterPage（注册页入口）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 无 | - | - | 纯展示组件 |

**RegisterForm（注册表单）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| onRegisterSuccess | (user: User, accessToken: string, refreshToken: string) => void | 是 | 注册成功后的回调函数 |
| onNavigateToLogin | () => void | 是 | 跳转到登录页的回调函数 |

**职责**：处理用户注册的全部逻辑，包括邮箱验证、密码校验、验证码发送和验证、账户创建。

#### 5.2.3 找回密码模块组件

**ForgotPasswordPage（找回密码页入口）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 无 | - | - | 纯展示组件 |

**ForgotPasswordForm（找回密码表单）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| onResetSuccess | () => void | 是 | 密码重置成功后的回调函数 |
| onNavigateToLogin | () => void | 是 | 跳转到登录页的回调函数 |

**职责**：管理找回密码的步骤切换和各步骤表单的渲染。

**StepIndicator（步骤指示器）**

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| currentStep | number | 是 | 当前步骤（1-3） |
| totalSteps | number | 否 | 默认3 | 总步骤数 |

**职责**：显示当前进度，标记已完成步骤和当前激活步骤。

### 5.3 组件通信机制

组件间通信采用以下方式，确保数据流清晰可追踪：

- **父子通信**：通过props传递数据和回调函数
- **状态管理**：使用Zustand管理全局认证状态
- **路由跳转**：使用react-router-dom的useNavigate钩子

## 六、状态管理设计

### 6.1 AuthStore扩展

在现有的AuthStore基础上，新增`rememberMe`状态和相关方法：

```typescript
// src/stores/authStore.ts 扩展

interface AuthState {
  // 现有状态
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  isAuthenticated: boolean;

  // 新增状态
  rememberMe: boolean;  // 是否记住我

  // 新增方法
  setRememberMe: (remember: boolean) => void;

  // 现有方法保持不变
  setAuth: (user: User, accessToken: string, refreshToken: string) => void;
  clearAuth: () => void;
  refreshToken: () => Promise<void>;
}
```

### 6.2 Token存储策略

根据"记住我"状态，采用不同的Token存储策略：

| 状态 | accessToken有效期 | refreshToken有效期 | 存储位置 |
|------|-------------------|-------------------|----------|
| 勾选记住我 | 30天 | 30天 | localStorage |
| 未勾选 | 7天 | 30天 | sessionStorage |

**实现逻辑**：

```typescript
const handleLogin = (rememberMe: boolean, tokens: AuthTokens) => {
  const storage = rememberMe ? localStorage : sessionStorage;

  storage.setItem('accessToken', tokens.accessToken);
  storage.setItem('refreshToken', tokens.refreshToken);

  useAuthStore.getState().setAuth(user, tokens.accessToken, tokens.refreshToken);
  useAuthStore.getState().setRememberMe(rememberMe);
};
```

## 七、路由配置设计

### 7.1 路由定义

在App.tsx中更新路由配置，新增登录、注册、找回密码页面路由：

```typescript
// src/App.tsx

<Routes>
  {/* ========== 公开路由 ========== */}
  <Route path="/login" element={<LoginPage />} />
  <Route path="/register" element={<RegisterPage />} />
  <Route path="/forgot-password" element={<ForgotPasswordPage />} />

  {/* ========== 受保护路由 ========== */}
  <Route element={<ProtectedRoute />}>
    <Route path="/home" element={<HomePage />} />
    {/* 其他需要登录才能访问的页面 */}
  </Route>

  {/* ========== 默认路由 ========== */}
  <Route path="/" element={<Navigate to="/login" replace />} />
  <Route path="*" element={<Navigate to="/login" replace />} />
</Routes>
```

### 7.2 路由守卫更新

更新ProtectedRoute组件，处理已登录用户访问公开路由的情况：

```typescript
// src/components/ProtectedRoute.tsx

const ProtectedRoute = ({ children }: { children: React.ReactNode }) => {
  const { isAuthenticated } = useAuthStore();
  const location = useLocation();

  // 已登录用户访问登录/注册/找回密码页，自动跳转到主页
  const publicRoutes = ['/login', '/register', '/forgot-password'];
  const isPublicRoute = publicRoutes.includes(location.pathname);

  if (isAuthenticated && isPublicRoute) {
    return <Navigate to="/home" replace />;
  }

  // 未登录用户访问受保护页面，跳转到登录页
  if (!isAuthenticated && !isPublicRoute) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  return children;
};
```

## 八、实现计划

### 8.1 前端任务清单

| 任务ID | 任务名称 | 任务描述 | 优先级 | 预估工时 |
|--------|----------|----------|--------|----------|
| T1.1 | 更新路由配置 | 在App.tsx中新增登录、注册、找回密码路由 | 高 | 0.5天 |
| T1.2 | 重构登录页 | 重构Login页面，添加MoonLight标题和独立登录表单 | 高 | 1天 |
| T1.3 | 创建注册页 | 创建Register页面，包含邮箱、密码、验证码表单 | 高 | 1天 |
| T1.4 | 创建找回密码页 | 创建ForgotPassword页面，实现三步骤流程 | 高 | 1.5天 |
| T1.5 | 更新状态管理 | 在AuthStore中添加rememberMe状态 | 中 | 0.5天 |
| T1.6 | 更新API封装 | 在auth.ts中新增找回密码相关API | 中 | 0.5天 |
| T1.7 | 更新路由守卫 | 完善ProtectedRoute，处理公开路由的跳转逻辑 | 中 | 0.5天 |
| T1.8 | 清理旧代码 | 删除原有的多步登录组件（EmailStep、PasswordStep等） | 低 | 0.5天 |

### 8.2 后端任务清单

| 任务ID | 任务名称 | 任务描述 | 优先级 | 预估工时 |
|--------|----------|----------|--------|----------|
| T2.1 | 实现发送重置码接口 | 实现 `/auth/send-reset-code` API | 高 | 0.5天 |
| T2.2 | 实现验证重置码接口 | 实现 `/auth/verify-reset-code` API | 高 | 0.5天 |
| T2.3 | 实现重置密码接口 | 实现 `/auth/reset-password` API | 高 | 0.5天 |
| T2.4 | 更新登录错误返回 | 登录接口返回更详细的错误类型 | 中 | 0.5天 |

### 8.3 实现顺序

按照依赖关系确定实现顺序：

```
前端流程：                    后端流程：
┌──────────────┐             ┌──────────────┐
│  T1.1 路由配置 │             │  T2.4 登录错误 │
└──────┬───────┘             └──────┬───────┘
       │                            │
       ▼                            ▼
┌──────────────┐             ┌──────────────┐
│ T1.6 API封装  │             │ T2.1 发送重置码│
└──────┬───────┘             └──────┬───────┘
       │                            │
       ▼                            ▼
┌──────────────┐             ┌──────────────┐
│ T1.2 登录页面 │             │ T2.2 验证重置码│
└──────┬───────┘             └──────┬───────┘
       │                            │
       ▼                            ▼
┌──────────────┐             ┌──────────────┐
│ T1.3 注册页面 │             │ T2.3 重置密码 │
└──────┬───────┘             └──────────────┘
       │
       ▼
┌──────────────┐
│ T1.4 找回密码 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ T1.5 状态管理 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ T1.7 路由守卫 │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│ T1.8 清理旧码 │
└──────────────┘
```

### 8.4 里程碑

| 里程碑 | 包含任务 | 验收标准 |
|--------|----------|----------|
| M1 后端接口 | T2.1-T2.4 | 所有找回密码API可用，登录返回详细错误 |
| M2 登录功能 | T1.1, T1.2, T1.6 | 登录页显示MoonLight标题，能正常登录 |
| M3 注册功能 | T1.3 | 能完成注册流程，成功创建账户 |
| M4 找回密码 | T1.4, T1.5, T1.7 | 能完成找回密码全流程 |
| M5 代码清理 | T1.8 | 删除旧的多步登录组件，无冗余代码 |

## 九、验收标准

### 9.1 功能验收

| 场景 | 预期结果 | 验收方法 |
|------|----------|----------|
| 访问 `/login` | 显示登录页，主标题为"MoonLight"，无"欢迎回来"文字 | 手动测试 |
| 输入未注册邮箱 + 正确密码 | 显示黄色提示"该邮箱尚未注册，请先注册账号" | 手动测试 |
| 输入已注册邮箱 + 错误密码 | 显示红色提示"密码错误，请重试" | 手动测试 |
| 输入正确邮箱密码 | 登录成功，自动跳转到主页 | 手动测试 |
| 勾选"记住我" | 下次访问时保持登录状态（token有效期30天） | 手动测试 |
| 点击"注册"链接 | 跳转到 `/register` 页面 | 手动测试 |
| 点击"忘记密码"链接 | 跳转到 `/forgot-password` 页面 | 手动测试 |
| 完整注册流程 | 输入邮箱、密码、验证码，成功创建账户并登录 | 手动测试 |
| 完整找回密码流程 | 输入邮箱获取验证码 → 输入验证码 → 设置新密码 → 跳转登录页 | 手动测试 |

### 9.2 交互验收

| 场景 | 预期结果 | 验收方法 |
|------|----------|----------|
| 验证码倒计时 | 发送验证码后按钮禁用，显示60秒倒计时 | 手动测试 |
| 密码可见性切换 | 点击眼睛图标显示/隐藏密码 | 手动测试 |
| 表单实时校验 | 邮箱格式错误、密码长度不足时实时提示 | 手动测试 |
| 加载状态 | 提交时按钮显示loading，避免重复提交 | 手动测试 |
| 步骤切换 | 找回密码各步骤按顺序切换，上一步骤标记完成 | 手动测试 |

### 9.3 性能验收

| 指标 | 目标值 | 验收方法 |
|------|--------|----------|
| 页面加载时间 | 小于1秒 | Lighthouse测试 |
| 登录响应时间 | 小于500毫秒 | Chrome DevTools Network |
| 验证码发送响应 | 小于1秒 | Chrome DevTools Network |

### 9.4 兼容性验收

| 浏览器 | 最低版本 | 验收方法 |
|--------|----------|----------|
| Chrome | 90+ | 手动测试 |
| Firefox | 88+ | 手动测试 |
| Safari | 14+ | 手动测试 |
| Edge | 90+ | 手动测试 |

## 十、风险评估与应对

### 10.1 风险清单

| 风险类型 | 风险描述 | 风险等级 | 发生概率 | 影响程度 |
|----------|----------|----------|----------|----------|
| 后端API延迟 | 后端找回密码接口未能按时完成 | 中 | 40% | 前端需预留接口位置，后续对接 |
| 安全漏洞 | 找回密码流程存在安全漏洞 | 高 | 10% | 验证码有效期限制、IP频率限制 |
| 用户体验偏差 | 实现效果与用户预期不符 | 低 | 20% | 先实现基础功能，后续迭代优化 |
| 性能问题 | 页面加载或响应速度不达标 | 低 | 15% | 优化代码结构，懒加载非关键组件 |

### 10.2 应对措施

**后端API延迟应对**：

- 前端接口先行定义好，与后端约定好接口契约
- 后端接口未就绪时，可使用mock数据进行开发和测试
- 设置明确的后端交付里程碑，跟踪进度

**安全漏洞应对**：

- 验证码有效期限制为30分钟
- 发送频率限制为每分钟最多1次
- 验证码错误次数限制为5次
- 密码重置成功后使所有现有token失效
- 记录完整的操作日志，便于安全审计

**用户体验偏差应对**：

- 实现过程中保持与用户沟通，及时反馈进度
- 先实现核心功能，细节优化后续迭代
- 收集用户反馈，快速响应调整

## 十一、相关文档

| 文档名称 | 路径 | 说明 |
|----------|------|------|
| 原登录系统设计 | [01-login-system-design.md](./01-login-system-design.md) | 原有登录系统设计文档，包含技术细节 |
| 主页设计文档 | [02-homepage-design.md](./02-homepage-design.md) | 主页设计文档，登录后跳转目标 |
| 前端代码规范 | 前端项目根目录 | 代码风格、组件规范、TypeScript使用指南 |
| 后端API文档 | 后端项目docs目录 | 完整API接口文档 |

## 附录

### 附录A：术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 记住我 | Remember Me | 用户选择后延长登录状态的持久化功能 |
| 验证码 | Verification Code | 用于验证用户身份的随机数字码 |
| Token | Token | 用于身份认证的访问令牌 |
| 刷新令牌 | Refresh Token | 用于获取新访问令牌的凭证 |

### 附录B：修订历史

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|----------|
| v1.0 | 2026-02-02 | AI Assistant | 初始版本，创建登录页面重构设计文档 |
